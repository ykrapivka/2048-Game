const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t.map(t=>[...t]),this.board=t.map(t=>[...t]),this.score=0,this.status="idle"}arraysEqual(t,e){return JSON.stringify(t)===JSON.stringify(e)}turnBoard(t){let e=this.board.length,r=Array.from({length:e},()=>Array(e).fill(0));if("forward"===t){for(let t=0;t<e;t++)for(let s=0;s<e;s++)r[s][e-1-t]=this.board[t][s];this.board=r}else if("back"===t){for(let t=0;t<e;t++)for(let s=0;s<e;s++)r[e-1-s][t]=this.board[t][s];this.board=r}}compressRow(t){if("idle"===this.getStatus()||"win"===this.getStatus())return;let e=!1;if(("up"===t||"down"===t)&&this.turnBoard("forward"),this.board.forEach((r,s)=>{let o=[...r],a=r.filter(t=>t>0),i=[];("left"===t||"down"===t)&&a.reverse();for(let t=a.length-1;t>=0;t--)a[t]===a[t-1]&&t>0?(i.unshift(2*a[t]),this.score+=2*a[t],2*a[t]==2048&&(this.status="win"),t--,e=!0):i.unshift(a[t]);for(;i.length<4;)i.unshift(0);("left"===t||"down"===t)&&i.reverse(),this.arraysEqual(o,i)||(e=!0),this.board[s]=i}),("up"===t||"down"===t)&&this.turnBoard("back"),e){let[t,e]=this.randomCell();this.board[t][e]=this.pickRandomNumber()}this.canMove()||(this.status="lose")}randomCell(){let t=Math.floor(4*Math.random()),e=Math.floor(4*Math.random());for(;0!==this.board[t][e];)t=Math.floor(4*Math.random()),e=Math.floor(4*Math.random());return[t,e]}pickRandomNumber(){return .1>Math.random()?4:2}canMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.board[t][e]||e<3&&this.board[t][e]===this.board[t][e+1]||t<3&&this.board[t][e]===this.board[t+1][e])return!0;return!1}moveLeft(){this.compressRow("left")}moveRight(){this.compressRow("right")}moveUp(){this.compressRow("up")}moveDown(){this.compressRow("down")}getScore(){return this.score}getState(){return this.board.map(t=>[...t])}getStatus(){return this.status}start(){this.status="playing";let[t,e]=this.randomCell(),[r,s]=this.randomCell();for(;t===r&&e===s;)[r,s]=this.randomCell();this.board[t][e]=this.pickRandomNumber(),this.board[r][s]=this.pickRandomNumber()}restart(){this.board=this.initialState.map(t=>[...t]),this.score=0,this.status="idle"}},e=document.querySelector("tbody"),r=document.querySelector(".game-score"),s=document.querySelector("button"),o=e.querySelectorAll("tr"),a=document.querySelectorAll("td"),i=document.querySelector(".message-start"),n=document.querySelector(".message-win"),l=document.querySelector(".message-lose");function d(t){t.classList.contains(`field-cell--${t.textContent}`)&&t.classList.remove(`field-cell--${t.textContent}`),t.textContent=""}function h(){for(let e=0;e<t.board.length;e++){let s=o[e].querySelectorAll("td");for(let r=0;r<t.board[e].length;r++)0!==t.board[e][r]?(d(s[r]),s[r].textContent=t.board[e][r],function(t){t.classList.add(`field-cell--${t.textContent}`)}(s[r])):d(s[r]);r.textContent=t.score}}s.addEventListener("click",()=>{"Start"===s.textContent?(t.start(),h(),s.textContent="Restart",s.classList.remove("start"),s.classList.add("restart"),i.classList.add("hidden")):"Restart"===s.textContent&&(t.restart(),h(),l.classList.add("hidden"),n.classList.add("hidden"),i.classList.remove("hidden"),s.classList.remove("restart"),s.classList.add("start"),s.textContent="Start",a.forEach(t=>{d(t)}))}),window.addEventListener("keydown",e=>{switch(e.preventDefault(),e.key){case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight()}"win"===t.getStatus()&&n.classList.remove("hidden"),"lose"===t.getStatus()&&l.classList.remove("hidden"),h()});
//# sourceMappingURL=index.7740fc8a.js.map
